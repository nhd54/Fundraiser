<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase-firestore.js"></script>

    <link rel="stylesheet" href="style/css/style.css" />
    <title>Document</title>
  </head>
  <body>
    <div id="wrapper">
      <nav>
        <img src="https://via.placeholder.com/150" alt="" />

        <ul class="menu">
          <li><a href="dashboard.html">OVERSIGT</a></li>
          <li><a href="details.html">DETALJER</a></li>
          <li><a href="settings.html">INDSTILLINGER</a></li>
        </ul>
      </nav>

      <article class="largeColumn" id="dashboard">
        <header class="largeColumn">
          <img src="https://via.placeholder.com/150" alt="" />
          <h1>
            FUNDRAISER <br />
            OVERSIGT
          </h1>
        </header>
        <section class="largeColumn details">
          <div id="time" class="bigColumn">
            <img src="https://via.placeholder.com/100" alt="" />
            <p class="start"></p>
            <img src="https://via.placeholder.com/100" alt="" />
            <p class="end"></p>
          </div>
          <div id="country" class="biggerColumn">
            <div class="map"></div>
            <div class="mapInfo"><span></span> <span></span> <span></span></div>
          </div>
        </section>
        <section class="largeColumn details">
          <div id="history" class="biggerColumn">
            <img src="https://via.placeholder.com/250" alt="" />
          </div>
          <div id="allDonation" class="bigColumn"><ul id="myList"></ul></div>
        </section>
        <footer class="largeColumn"></footer>
      </article>
    </div>
    <script src="app.js"></script>

    <script>
      let span = document.createElement("p");
      let fundraiser = [];
      let topDonations = [];
      let fyn = [];
      let jylland = [];
      let sjaelland = [];
      let sum = 0;
      let donations = [];
      let countFyn = document.querySelector(".mapInfo span:nth-child(2)");
      let countsjaelland = document.querySelector("#country span:nth-child(3)");
      let countJylland = document.querySelector("#country span:nth-child(1)");

      document.addEventListener("DOMContentLoaded", init);

      async function init() {
        let headerData = await fetch("maps.html");
        let header = await headerData.text();
        document.querySelector(".map").innerHTML = header;

        db.collection("fundraise")
          .get()
          .then(snapshot => {
            snapshot.docs.forEach(doc => {
              fundraiser.push(doc.data());
            });
            document.querySelector(".start").textContent =
              fundraiser[0].startdate;
            document.querySelector(".end").textContent = fundraiser[0].enddate;
          });

        // med limits (kun 7 visning den nyeste )
        db.collection("donations")
          .limit(7)
          .get()
          .then(snapshot => {
            snapshot.docs.forEach(doc => {
              topDonations.push(doc.data());
            });
            topDonations.forEach(person => {
              console.log(person.name);

              var node = document.createElement("LI");
              var textnode = document.createTextNode(person.name);
              node.appendChild(textnode);
              document.getElementById("myList").appendChild(node);

              document.querySelector("#allDonation").appendChild(span);
            });
          });

        db.collection("donations")
          .get()
          .then(snapshot => {
            snapshot.docs.forEach(doc => {
              donations.push(doc.data());
            });
            test();
            count();

            sum = fyn.length + jylland.length + sjaelland.length;

            countFyn.textContent = Math.round((fyn.length / sum) * 100) + "%";
            countJylland.textContent =
              Math.round((jylland.length / sum) * 100) + "%";
            countsjaelland.textContent =
              Math.round((sjaelland.length / sum) * 100) + "%";
          });
      }

      function test() {
        donations.forEach(country => {
          if (country.country == "fyn") {
            fyn.push(country);
          } else if (country.country == "jylland") {
            jylland.push(country);
          } else if (country.country == "sjÃ¦lland") {
            sjaelland.push(country);
          }
        });
      }

      function count() {
        if (
          sjaelland.length > fyn.length &&
          sjaelland.length > jylland.length
        ) {
          document.querySelector("#sjaelland").style.fill = "#242f41";
          document.querySelector("#fyn").style.fill = "#6a82a0";
          document.querySelector("#jylland").style.fill = "#6a82a0";
        } else if (fyn.length > sjaelland.length && fyn.length) {
          document.querySelector("#sjaelland").style.fill = "#6a82a0";
          document.querySelector("#fyn").style.fill = "#242f41";
          document.querySelector("#jylland").style.fill = "#6a82a0";
        } else if (
          jylland.length > sjaelland.length &&
          jylland.length > fyn.length
        ) {
          document.querySelector("#sjaelland").style.fill = "#6a82a0";
          document.querySelector("#fyn").style.fill = "#6a82a0";
          document.querySelector("#jylland").style.fill = "#242f41";
        }
      }
    </script>
  </body>
</html>
