<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase-firestore.js"></script>

    <link rel="stylesheet" href="style/css/style.css" />
    <title>Document</title>
  </head>
  <body>
    <div id="wrapper">
      <nav>
        <img src="image/logo.svg" alt="" />

        <div class="accordion">
          <div class="bar1"></div>
          <div class="bar2"></div>
          <div class="bar3"></div>
        </div>

        <nav>
          <ul class="menu">
            <li>
              <img src="image/icon_oversigt.svg" />
              <a href="dashboard.html">OVERSIGT</a>
            </li>
            <li>
              <img src="image/icon_detaljer.svg" />
              <a href="details.html">DETALJER</a>
            </li>
            <li>
              <img src="image/icon_settings.svg" />
              <a href="settings.html">INDSTILLINGER</a>
            </li>
          </ul>
        </nav>
      </nav>

      <article class="largeColumn mobileSetting" id="dashboard">
        <header class="largeColumn">
          <img src="image/icon_detaljer.svg" alt="" /><br />
          <h1>
            FUNDRAISER <br />
            DETALJER
          </h1>
        </header>
        <section class="largeColumn mobileSetting details">
          <div id="time" class="bigColumn">
            FUNDRAISER START <img src="image/icon_start.svg" alt="" />
            <p class="start"></p>
            FUNRAISER SLUT <img src="image/icon_dato.svg" alt="" />
            <p class="end"></p>
          </div>
          <div id="country" class="biggerColumn">
            <div class="kortInfo">
              DONATION PR: LANDSDEL<br />
              <h4><img src="image/kortfarve-01.jpg" />MEST DONERET</h4>
            </div>
            <div class="map"></div>
            <div class="mapInfo">
              JYLLAND:<span class="kortSpan"></span> FYN & ØERNE:<span
                class="kortSpan"
              ></span>
              SJÆLLAND:<span></span>
            </div>
          </div>
        </section>
        <section class="largeColumn mobileSetting details">
          <div id="history" class="biggerColumn">
            DONATIONS HISTORIE
            <div id="overallDonations">
              <strong>DKK</strong>
              <div class="graph">
                <div class="week"></div>
                <div class="week"></div>
                <div class="week"></div>
                <div class="week"></div>
                <div class="week"></div>
                <div class="week"></div>
                <div class="week"></div>
                <div class="week"></div>
                <div class="week"></div>
                <div class="week"></div>
              </div>
              <strong>Uger</strong> <span>1</span> <span>2</span>
              <span>3</span> <span>4</span> <span>5</span> <span>6</span>
              <span>7</span> <span>8</span> <span>9</span> <span>10</span>
            </div>
          </div>
          <div id="allDonation" class="bigColumn">
            DONATER
            <ul id="myList"></ul>
          </div>
        </section>
        <footer class="largeColumn"></footer>
      </article>
    </div>
    <script src="app.js"></script>

    <script>
      let span = document.createElement("p");
      let fundraiser = [];
      let topDonations = [];
      let fyn = [];
      let jylland = [];
      let sjaelland = [];
      let sum = 0;
      let donations = [];
      let countFyn = document.querySelector(".mapInfo span:nth-child(2)");
      let countsjaelland = document.querySelector("#country span:nth-child(3)");
      let countJylland = document.querySelector("#country span:nth-child(1)");
      let week1 = [];
      let week2 = [];
      let week3 = [];
      let week4 = [];
      let week5 = [];
      let week6 = [];
      let week7 = [];
      let week8 = [];
      let week9 = [];
      let week10 = [];

      document.addEventListener("DOMContentLoaded", init);

      async function init() {
        let headerData = await fetch("maps.html");
        let header = await headerData.text();
        document.querySelector(".map").innerHTML = header;

        db.collection("fundraise")
          .get()
          .then(snapshot => {
            snapshot.docs.forEach(doc => {
              fundraiser.push(doc.data());
            });
            document.querySelector(".start").textContent =
              fundraiser[0].startDate;
            document.querySelector(".end").textContent = fundraiser[0].endDate;
          });

        // med limits (kun 7 visning den nyeste )
        db.collection("donations")
          .limit(7)
          .get()
          .then(snapshot => {
            snapshot.docs.forEach(doc => {
              topDonations.push(doc.data());
            });
            topDonations.forEach(person => {
              var node = document.createElement("LI");
              var textnode = document.createTextNode(person.firstname);
              node.appendChild(textnode);
              document.getElementById("myList").appendChild(node);

              document.querySelector("#allDonation").appendChild(span);
            });
          });

        db.collection("donations")
          .get()
          .then(snapshot => {
            snapshot.docs.forEach(doc => {
              donations.push(doc.data());
            });
            test();
            count();
            countDate();

            document.querySelector(".graph").children[0].style.height =
              week1.length + "%";
            document.querySelector(".graph").children[1].style.height =
              week2.length + "%";
            document.querySelector(".graph").children[2].style.height =
              week3.length + "%";
            document.querySelector(".graph").children[3].style.height =
              week4.length + "%";
            document.querySelector(".graph").children[3].style.height =
              week5.length + "%";
            document.querySelector(".graph").children[3].style.height =
              week6.length + "%";
            document.querySelector(".graph").children[3].style.height =
              week7.length + "%";
            document.querySelector(".graph").children[3].style.height =
              week8.length + "%";
            document.querySelector(".graph").children[3].style.height =
              week9.length + "%";
            document.querySelector(".graph").children[3].style.height =
              week10.length + "%";

            sum = fyn.length + jylland.length + sjaelland.length;

            countFyn.textContent = Math.round((fyn.length / sum) * 100) + "%";
            countJylland.textContent =
              Math.round((jylland.length / sum) * 100) + "%";
            countsjaelland.textContent =
              Math.round((sjaelland.length / sum) * 100) + "%";
          });
      }

      let acc = document.getElementsByClassName("accordion");
      var i;
      for (i = 0; i < acc.length; i++) {
        acc[i].addEventListener("click", function() {
          this.classList.toggle("active");
          let panel = document.querySelector(".menu");
          if (panel.style.display === "block") {
            panel.style.display = "none";
          } else {
            panel.style.display = "block";
          }
        });
      }

      function test() {
        donations.forEach(country => {
          if (country.country == "fyn") {
            fyn.push(country);
          } else if (country.country == "jylland") {
            jylland.push(country);
          } else if (country.country == "sjælland") {
            sjaelland.push(country);
          }
        });
      }

      function count() {
        if (
          sjaelland.length > fyn.length &&
          sjaelland.length > jylland.length
        ) {
          document.querySelector("#sjaelland").style.fill = "#242f41";
          document.querySelector("#fyn").style.fill = "#6a82a0";
          document.querySelector("#jylland").style.fill = "#6a82a0";
        } else if (fyn.length > sjaelland.length && fyn.length) {
          document.querySelector("#sjaelland").style.fill = "#6a82a0";
          document.querySelector("#fyn").style.fill = "#242f41";
          document.querySelector("#jylland").style.fill = "#6a82a0";
        } else if (
          jylland.length > sjaelland.length &&
          jylland.length > fyn.length
        ) {
          document.querySelector("#sjaelland").style.fill = "#6a82a0";
          document.querySelector("#fyn").style.fill = "#6a82a0";
          document.querySelector("#jylland").style.fill = "#242f41";
        }
      }

      function countDate() {
        donations.forEach(time => {
          console.log(time.amount);
          if (time.date > "01-12-18" && time.date < "09-12-18") {
            week1.push(time.amount);
          } else if (time.date > "10-12-18" && time.date < "16-12-18") {
            week2.push(time.amount);
          } else if (time.date > "17-12-18" && time.date < "23-12-18") {
            week3.push(time.amount);
          } else if (time.date > "24-12-18" && time.date < "31-12-18") {
            week4.push(time.amount);
          } else if (time.date > "01-01-19" && time.date < "09-01-19") {
            week5.push(time.amount);
          } else if (time.date > "10-01-19" && time.date < "16-01-19") {
            week6.push(time.amount);
          } else if (time.date > "17-01-19" && time.date < "23-01-19") {
            week7.push(time.amount);
          } else if (time.date > "01-02-19" && time.date < "10-02-19") {
            week8.push(time.amount);
          } else if (time.date > "11-02-19" && time.date < "17-02-19") {
            week9.push(time.amount);
          } else if (time.date > "18-02-19" && time.date < "24-02-19") {
            week10.push(time.amount);
          }
        });
      }
    </script>
  </body>
</html>
